---
import Layout from '../../layouts/Layout.astro';
import Hero from '../../sections/Hero.astro';
import Tools from '../../sections/Tools.astro';
import ProjectPanel from '../../components/ProjectPanel.astro';
import { getCollection } from 'astro:content';

const projects = await getCollection('projects');
---

<Layout title="JAMIN YAURI // MECHATRONICS & AI ARCHITECT">
	<main class="overflow-x-hidden relative">
		<!-- THE TECHNICAL GUIDE LINE (desktop only) -->
		<div class="hidden md:block fixed bottom-[10%] left-0 w-full h-px bg-neutral-900 z-50 pointer-events-none">
			<div id="guide-progress" class="absolute top-0 left-0 h-full bg-accent-yellow/20 w-0"></div>
			
			<!-- THE MECHANICAL TRACKER (The "Bee" concept simplified) -->
			<div id="mech-guide" class="absolute top-1/2 left-0 -translate-y-1/2 -translate-x-1/2 flex flex-col items-center">
				<svg width="60" height="40" viewBox="0 0 100 60" xmlns="http://www.w3.org/2000/svg">
					<g fill="none" stroke="#FFD700" stroke-width="2">
						<!-- Technical wings -->
						<path d="M20,30 L0,10" class="guide-wing-l" />
						<path d="M20,30 L0,50" class="guide-wing-l" />
						<path d="M80,30 L100,10" class="guide-wing-r" />
						<path d="M80,30 L100,50" class="guide-wing-r" />
						<!-- Eyes/Sensors -->
						<circle cx="40" cy="30" r="8" fill="#050505" stroke-width="1"/>
						<circle cx="60" cy="30" r="8" fill="#050505" stroke-width="1"/>
						<circle cx="40" cy="30" r="3" fill="#FFD700" class="animate-pulse"/>
						<circle cx="60" cy="30" r="3" fill="#FFD700" class="animate-pulse"/>
					</g>
				</svg>
				<span class="text-[8px] font-mono text-accent-yellow mt-2 uppercase tracking-widest opacity-50">Tracker_V.01</span>
			</div>
		</div>

		<div id="horizontal-wrapper" class="flex flex-col md:flex-nowrap md:h-screen">
			<Hero />
			
			{projects.map((project) => (
				<ProjectPanel 
					title={project.data.title}
					type={project.data.type}
					description={project.data.description}
					tags={project.data.tags}
					role={project.data.role}
				/>
			))}

			<Tools />

			<section class="panel bg-accent-yellow text-bg-deep flex flex-col justify-center items-center text-center relative overflow-hidden" id="contact-panel">
				<div class="absolute inset-0 pointer-events-none opacity-10" id="contact-bg-effect">
					<div class="absolute top-1/4 left-1/4 transform -translate-x-1/2 -translate-y-1/2 text-[20vw] font-black uppercase tracking-tighter select-none">Contact</div>
					<div class="absolute bottom-1/4 right-1/4 transform translate-x-1/2 translate-y-1/2 text-[20vw] font-black uppercase tracking-tighter select-none">Direct</div>
				</div>

				<h2 class="text-6xl md:text-[8vw] font-black text-bg-deep leading-[0.8] mb-8 relative z-10" id="contact-title">
					LET'S <br/> COLLABORATE
				</h2>
				
				<div class="space-y-4 mb-12 relative z-10">
					<p class="text-xl md:text-2xl font-mono uppercase tracking-widest">
						Based in Peru // Global Reach // 2026
					</p>
					<a href="mailto:jamin.yauri@pucp.edu.pe" class="text-2xl md:text-3xl font-bold border-b-2 border-bg-deep hover:bg-bg-deep hover:text-accent-yellow transition-all px-2">
						jamin.yauri@pucp.edu.pe
					</a>
				</div>

				<div class="flex flex-wrap justify-center gap-6 md:gap-12 relative z-10">
					{[
						{ 
							name: 'Github', 
							url: 'https://github.com/JaminYC',
							icon: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.28 1.15-.28 2.35 0 3.5-.73 1.02-1.08 2.25-1 3.5 0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2-7-2"></path></svg>`
						},
						{ 
							name: 'LinkedIn', 
							url: 'https://www.linkedin.com/in/jaminyauri/',
							icon: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect width="4" height="12" x="2" y="9"></rect><circle cx="4" cy="4" r="2"></circle></svg>`
						},
						{ 
							name: 'Instagram', 
							url: 'https://www.instagram.com/jaminyauri/',
							icon: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="20" x="2" y="2" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" x2="17.51" y1="6.5" y2="6.5"></line></svg>`
						}
					].map(social => (
						<a 
							href={social.url} 
							target="_blank" 
							rel="noopener noreferrer"
							class="flex items-center gap-3 text-xs font-mono uppercase tracking-[0.3em] font-bold border border-bg-deep px-8 py-4 hover:bg-bg-deep hover:text-accent-yellow transition-all group"
						>
							<span set:html={social.icon} class="group-hover:scale-110 transition-transform" />
							{social.name}
						</a>
					))}
				</div>
			</section>
		</div>
	</main>
</Layout>

<script>
	import { gsap } from 'gsap';
	import { ScrollTrigger } from 'gsap/ScrollTrigger';

	gsap.registerPlugin(ScrollTrigger);

	const initExperience = () => {
		// On mobile: skip horizontal scroll, use natural vertical layout
		if (window.innerWidth < 768) return;

		const wrapper = document.getElementById('horizontal-wrapper');
		if (!wrapper) return;

		const panels = gsap.utils.toArray('.panel');
		if (panels.length === 0) return;

		// 1. MASTER SCROLL CALIBRATION
		// We use a high travel distance (3000px per panel) to ensure a very slow, deliberate scroll.
		const totalScrollDistance = panels.length * 3000;

		const mainTl = gsap.timeline({
			scrollTrigger: {
				trigger: "#horizontal-wrapper",
				pin: true,
				scrub: 2.5, // Heavier lag for a premium, intentional feel
				// Removed snap to give the user 100% manual control
				end: () => "+=" + totalScrollDistance,
				invalidateOnRefresh: true,
			}
		});

		// Animate all panels horizontally using xPercent for maximum stability
		mainTl.to(panels, {
			xPercent: -100 * (panels.length - 1),
			ease: "none",
		});

		// 2. GUIDE TRACKER CALIBRATION
		const tracker = document.getElementById('mech-guide');
		const progress = document.getElementById('guide-progress');
		
		if (tracker && progress) {
			// Move the tracker across the line perfectly synced with the scroll
			mainTl.to(tracker, {
				left: "100%",
				ease: "none",
			}, 0);

			mainTl.to(progress, {
				width: "100%",
				ease: "none",
			}, 0);

			// Technical "Sensors" pulse intensity based on scroll speed
			mainTl.to(".animate-pulse", {
				scale: 1.8,
				fill: "#FFFFFF",
				duration: 0.1,
				stagger: 0.1,
				yoyo: true,
				repeat: 3
			}, 0);
		}

		// Tracker Floating Animation
		gsap.to(tracker, {
			y: "+=10",
			repeat: -1,
			yoyo: true,
			duration: 2,
			ease: "sine.inOut"
		});

		// Wing Flutter
		gsap.to(".guide-wing-l", { rotate: 10, transformOrigin: "right center", repeat: -1, yoyo: true, duration: 0.1 });
		gsap.to(".guide-wing-r", { rotate: -10, transformOrigin: "left center", repeat: -1, yoyo: true, duration: 0.1 });

		// --- Contact Panel ---
		const contactPanel = document.getElementById('contact-panel');
		if (contactPanel) {
			contactPanel.addEventListener('mousemove', (e: MouseEvent) => {
				const { clientX, clientY } = e;
				const { width, height, left, top } = contactPanel.getBoundingClientRect();
				const x = (clientX - left - width / 2) / (width / 2);
				const y = (clientY - top - height / 2) / (height / 2);
				gsap.to("#contact-bg-effect", { x: x * 50, y: y * 50, duration: 0.6 });
				gsap.to("#contact-title", { rotateX: -y * 10, rotateY: x * 10, duration: 0.6 });
			});
		}
	};

	window.addEventListener('load', () => setTimeout(initExperience, 100));
	document.addEventListener('astro:after-swap', () => setTimeout(initExperience, 100));
</script>

<style is:global>
	@font-face {
		font-family: 'Outfit';
		src: url('https://fonts.googleapis.com/css2?family=Outfit:wght@100;400;900&display=swap');
	}
</style>
